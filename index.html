<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glioma Trial Enrollment Predictor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: auto;
            padding: 20px;
            text-align: center;
        }
        input, select {
            display: block;
            margin: 10px auto;
            padding: 8px;
            width: 80%;
        }
        button {
            padding: 10px 20px;
            background-color: blue;
            color: white;
            border: none;
            cursor: pointer;
        }
    </style>
</head>
    
<body>
    <h2>Glioma Clinical Trial Enrollment Predictor</h2>
    <form id="predictionForm">
        <label for="AI">Age at Initial Diagnosis (years):</label>
        <input type="number" id="AI" required><br>

        <label for="EM">Employment Status:</label>
        <select id="EM" required>
            <option value="1">Employed</option>
            <option value="2">Unemployed</option>
            <option value="3">Retired</option>
            <option value="Unknown">Unknown</option>
        </select><br>

        <label for="EH">Ethnicity:</label>
        <select id="EH" required>
            <option value="1">Hispanic/Latino</option>
            <option value="2">Non-Hispanic/Latino</option>
            <option value="Unknown">Unknown</option>
        </select><br>

        <label for="KP">KPS Post-op:</label>
        <select id="KP" required>
            <option value="100">100</option>
            <option value="90">90</option>
            <option value="80">80</option>
            <option value="<80">Less than 80</option>
            <option value="NA">Unknown</option>
        </select><br>

        <label for="MI">Minority Status:</label>
        <select id="MI" required>
            <option value="1">Minority</option>
            <option value="2">Non-minority</option>
            <option value="Unknown">Unknown</option>
        </select><br>

        <label for="NT">Tumor Lobe:</label>
        <select id="NT" required>
            <option value="Frontal">Frontal</option>
            <option value="Parietal">Parietal</option>
            <option value="Temporal">Temporal</option>
            <option value="Brainstem">Brainstem, Insular, Basal Ganglia, or Thalamus</option>
            <option value="Multifocal">Multifocal</option>
            <option value="Occipital">Occipital</option>
            <option value="Cerebellum">Cerebellum</option>
            <option value="Unknown">Unknown</option>
        </select><br>

        <label for="IN">Insurance Status at Diagnosis:</label>
        <select id="IN" required>
            <option value="1">Private</option>
            <option value="2">Medi-cal/Medicaid</option>
            <option value="3">Medicare</option>
            <option value="4">Unknown</option>
            <option value="5">Self-pay</option>
        </select><br>

        <label for="SE">Seizure Pre-op:</label>
        <select id="SE" required>
            <option value="Yes">Yes</option>
            <option value="No">No</option>
            <option value="NA">Unknown</option>
        </select><br>

        <label for="SX">Sex:</label>
        <select id="SX" required>
            <option value="1">Male</option>
            <option value="2">Female</option>
        </select><br>

        <label for="TM">Received Chemotherapy?</label>
        <select id="TM" required>
            <option value="1">Yes</option>
            <option value="2">No</option>
            <option value="Unknown">Unknown</option>
        </select><br>

        <label for="RA">Race:</label>
        <select id="RA" required>
            <option value="White">White</option>
            <option value="Black">Black/African American</option>
            <option value="Hispanic">Hispanic/Latino</option>
            <option value="Asian">Asian</option>
            <option value="Pacific">Pacific Islander</option>
            <option value="Other">Other</option>
            <option value="Unknown">Unknown</option>
        </select><br>

        <label for="WG">WHO Grade:</label>
        <select id="WG" required>
            <option value="2-3">Grade 2-3</option>
            <option value="4">Grade 4</option>
        </select><br>

        <button type="button" onclick="calculateProbability()">Calculate Probability</button>
    </form>

    <h3 id="result"></h3>

    <script src="model.js"></script>
    <script>
        const variableMap = {
            "AI": "Age.at.Initial.Diagnosis",
            "EM": "Employed(Y=1, N=2, Retired=3) 2",
            "EH": "Ethnicity Hispanic/Latino (Yes=1, No=2) 2",
            "KP": "KPS.post.op 3",
            "MI": "Minority (Yes=1, No=2) 2",
            "NT": "New Tumor Lobe (updated chart review) 2 2 2",
            "IN": "Reordered insurance at diagnosis 2 2",
            "SE": "Seizure.preop 2",
            "SX": "Sex (M=1, F=2)",
            "TM": "TMZ anytime 2 2",
            "RA": "Updated Race White, Black/African American, Hispanic/Latino, Asian/Pacific Islander, American Indian/Alaska Native 3 2",
            "WG": "WHO Grade 2 2"
        };

        function calculateProbability() {
            let indata = {};

            for (let shortName in variableMap) {
                let fullName = variableMap[shortName];
                let inputElement = document.getElementById(shortName);
                if (inputElement) {
                    let value = inputElement.value;
                    indata[fullName] = isNaN(value) ? value : parseFloat(value);
                }
            }

            if (typeof score === "function") {
                let outdata = {};
                score(indata, outdata);

                document.getElementById("result").innerText =
                    `Estimated Probability: ${(outdata["Probability_Clinical_Trial_Enrollment"] * 100).toFixed(2)}%`;
            } else {
                console.error("score function is not defined. Make sure model.js is properly loaded.");
            }
        }
    </script>
</body>
</html>
